name: Build Backend Executables

on:
  push:
    branches: [main]
    paths-ignore:
      - frontend/**
      - .github/workflows/build.yml
      - Dockerfile
  pull_request:
    branches: [main]
    paths-ignore:
      - frontend/**
      - .github/workflows/build.yml
      - Dockerfile
  workflow_dispatch:
    inputs:
      platform:
        description: "Target platform for build"
        required: false
        default: "all"
        type: choice
        options:
          - all
          - windows
          - linux
          - macos

permissions:
  contents: read

jobs:
  build-backend:
    runs-on: ubuntu-latest
    env:
      NODE_OPTIONS: --max-old-space-size=8192
      NODE_MEMORY: 8192
      MEMORY: 8192M

    strategy:
      matrix:
        node-version: [22.x]
        platform: [windows, linux, macos]
        exclude:
          - platform: macos
            node-version: 22.x

    steps:
      - name: Checkout code
        uses: actions/checkout@main

      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@main
        with:
          node-version: ${{ matrix.node-version }}
          cache: "npm"
          cache-dependency-path: |
            package-lock.json

      - name: Set Node.js memory limits
        run: |
          echo "NODE_MEMORY_OPTIONS=--max-old-space-size=8192" >> $GITHUB_ENV
          echo "NPM_CONFIG_CACHE=/tmp/.npm" >> $GITHUB_ENV
          echo "ROLLUP_SKIP_NATIVE_DEPENDENCIES=true" >> $GITHUB_ENV
          echo "MEMORY=8192M" >> $GITHUB_ENV
          echo "NODE_MEMORY=8192" >> $GITHUB_ENV
        env:
          NODE_OPTIONS: --max-old-space-size=8192

      - name: Clean node_modules and lock
        run: |
          rm -rf node_modules package-lock.json
          rm -rf dist dist-obfuscated

      - name: Cache node_modules and npm cache
        uses: actions/cache@main
        with:
          path: |
            node_modules
            /tmp/.npm
          key: ${{ runner.os }}-node${{ matrix.node-version }}-backend-modules-${{ hashFiles('package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node${{ matrix.node-version }}-backend-modules-

      - name: Install dependencies with retry
        run: |
          npm install -g npm@latest
          npm install --no-optional --no-audit --no-fund
          # Install pkg globally for executable building
          npm install -g pkg@latest
        env:
          NODE_OPTIONS: --max-old-space-size=8192

      - name: Backend Build Analysis
        run: |
          echo "ğŸš€ å¼€å§‹åç«¯æ„å»ºåˆ†æ..."

          # åˆ›å»ºåç«¯åˆ†æç›®å½•
          mkdir -p backend-build-analysis

          # è®°å½•æ„å»ºå¼€å§‹æ—¶é—´
          echo "â° æ„å»ºå¼€å§‹æ—¶é—´: $(date)" > backend-build-analysis/build-timeline.log
          echo "ğŸ“Š å¼€å§‹åç«¯æ„å»ºåˆ†æ..." >> backend-build-analysis/build-timeline.log

      - name: Build backend with TypeScript compilation
        run: |
          echo "ğŸ”¨ å¼€å§‹åç«¯ TypeScript ç¼–è¯‘..."

          # ç¼–è¯‘ TypeScript
          npm run build:backend:clean

          # è®°å½•ç¼–è¯‘ç»“æœ
          echo "âœ… TypeScript ç¼–è¯‘å®Œæˆ" >> backend-build-analysis/build-timeline.log
          echo "ğŸ“ ç¼–è¯‘è¾“å‡ºç›®å½•: dist/" >> backend-build-analysis/build-timeline.log

          # åˆ†æç¼–è¯‘åçš„æ–‡ä»¶
          echo "ğŸ“Š ç¼–è¯‘æ–‡ä»¶åˆ†æ:" >> backend-build-analysis/build-timeline.log
          find dist/ -name "*.js" -exec du -h {} \; | sort -hr >> backend-build-analysis/build-timeline.log

          # æ£€æŸ¥ä¸»å…¥å£æ–‡ä»¶
          if [ -f "dist/app.js" ]; then
            echo "âœ… ä¸»å…¥å£æ–‡ä»¶ dist/app.js å­˜åœ¨" >> backend-build-analysis/build-timeline.log
            echo "ğŸ“ ä¸»æ–‡ä»¶å¤§å°: $(du -h dist/app.js | cut -f1)" >> backend-build-analysis/build-timeline.log
          else
            echo "âŒ ä¸»å…¥å£æ–‡ä»¶ dist/app.js ä¸å­˜åœ¨" >> backend-build-analysis/build-timeline.log
            exit 1
          fi
        env:
          NODE_OPTIONS: --max-old-space-size=8192

      - name: Backend Bundle Analysis
        run: |
          echo "ğŸ“Š å¼€å§‹åç«¯åŒ…åˆ†æ..."

          # åˆ†ææ„å»ºäº§ç‰©
          echo "ğŸ” åˆ†ææ„å»ºäº§ç‰©..."

          # æ£€æŸ¥ dist ç›®å½•ç»“æ„
          echo "ğŸ“ æ„å»ºç›®å½•ç»“æ„:" > backend-build-analysis/bundle-structure.log
          find dist/ -type f -exec du -h {} \; | sort -hr >> backend-build-analysis/bundle-structure.log

          # åˆ†æ JavaScript æ–‡ä»¶
          echo "ğŸ“¦ JavaScript æ–‡ä»¶åˆ†æ:" > backend-build-analysis/js-analysis.log
          find dist/ -name "*.js" -exec du -h {} \; | sort -hr >> backend-build-analysis/js-analysis.log

          # åˆ†æä¾èµ–å…³ç³»
          echo "ğŸ”— ä¾èµ–å…³ç³»åˆ†æ:" > backend-build-analysis/dependency-analysis.log
          npm list --depth=0 >> backend-build-analysis/dependency-analysis.log

          # æ£€æŸ¥ä»£ç æ··æ·†æ•ˆæœ
          if [ -d "dist-obfuscated" ]; then
            echo "ğŸ”’ ä»£ç æ··æ·†åˆ†æ:" > backend-build-analysis/obfuscation-analysis.log
            find dist-obfuscated/ -name "*.js" -exec du -h {} \; | sort -hr >> backend-build-analysis/obfuscation-analysis.log
          fi

      - name: Backend Performance Analysis
        run: |
          echo "âš¡ å¼€å§‹åç«¯æ€§èƒ½åˆ†æ..."

          # åˆ†ææ„å»ºæ€§èƒ½
          echo "â±ï¸ æ„å»ºæ€§èƒ½åˆ†æ:" > backend-build-analysis/performance.log

          # æ£€æŸ¥æ–‡ä»¶å‹ç¼©æ•ˆæœ
          echo "ğŸ—œï¸ æ–‡ä»¶å‹ç¼©åˆ†æ:" >> backend-build-analysis/performance.log
          find dist/ -name "*.js" -exec sh -c 'echo "=== $1 ==="; echo "åŸå§‹å¤§å°: $(wc -c < "$1") bytes"; echo "Gzip å¤§å°: $(gzip -c "$1" | wc -c) bytes"; echo "å‹ç¼©ç‡: $(( 100 - $(gzip -c "$1" | wc -c) * 100 / $(wc -c < "$1") ))%"' _ {} \; >> backend-build-analysis/performance.log

          # åˆ†æåŠ è½½æ€§èƒ½
          echo "ğŸ“ˆ åŠ è½½æ€§èƒ½åˆ†æ:" >> backend-build-analysis/performance.log
          echo "æ€»æ–‡ä»¶æ•°: $(find dist/ -type f | wc -l)" >> backend-build-analysis/performance.log
          echo "æ€»å¤§å°: $(du -sh dist/ | cut -f1)" >> backend-build-analysis/performance.log

          # æ£€æŸ¥å†…å­˜ä½¿ç”¨
          echo "ğŸ’¾ å†…å­˜ä½¿ç”¨åˆ†æ:" >> backend-build-analysis/performance.log
          free -h >> backend-build-analysis/performance.log

      - name: Backend Security Analysis
        run: |
          echo "ğŸ”’ å¼€å§‹åç«¯å®‰å…¨åˆ†æ..."

          # åˆ†æå®‰å…¨ç›¸å…³é…ç½®
          echo "ğŸ›¡ï¸ å®‰å…¨é…ç½®åˆ†æ:" > backend-build-analysis/security.log

          # æ£€æŸ¥æ•æ„Ÿä¿¡æ¯æ³„éœ²
          echo "ğŸ” æ•æ„Ÿä¿¡æ¯æ£€æŸ¥:" >> backend-build-analysis/security.log
          grep -r -i "password\|secret\|key\|token" dist/ --exclude-dir=node_modules || echo "æœªå‘ç°æ•æ„Ÿä¿¡æ¯" >> backend-build-analysis/security.log

          # æ£€æŸ¥ç¡¬ç¼–ç çš„ URL
          echo "ğŸŒ ç¡¬ç¼–ç  URL æ£€æŸ¥:" >> backend-build-analysis/security.log
          grep -r "http://\|https://" dist/ | grep -v "localhost" | head -10 >> backend-build-analysis/security.log || echo "æœªå‘ç°ç¡¬ç¼–ç  URL" >> backend-build-analysis/security.log

          # æ£€æŸ¥ç¯å¢ƒå˜é‡ä½¿ç”¨
          echo "ğŸ”§ ç¯å¢ƒå˜é‡æ£€æŸ¥:" >> backend-build-analysis/security.log
          grep -r "process\.env" dist/ | head -10 >> backend-build-analysis/security.log || echo "æœªå‘ç°ç¯å¢ƒå˜é‡ä½¿ç”¨" >> backend-build-analysis/security.log

      - name: Backend Quality Analysis
        run: |
          echo "ğŸ“‹ å¼€å§‹åç«¯è´¨é‡åˆ†æ..."

          # ä»£ç è´¨é‡åˆ†æ
          echo "ğŸ“Š ä»£ç è´¨é‡åˆ†æ:" > backend-build-analysis/quality.log

          # æ£€æŸ¥ TypeScript ç¼–è¯‘é”™è¯¯
          echo "ğŸ“ TypeScript æ£€æŸ¥:" >> backend-build-analysis/quality.log
          npx tsc --noEmit --project tsconfig.json 2>&1 >> backend-build-analysis/quality.log || echo "TypeScript æ£€æŸ¥å‘ç°é—®é¢˜" >> backend-build-analysis/quality.log

          # æ£€æŸ¥æœªä½¿ç”¨çš„ä»£ç 
          echo "ğŸ—‘ï¸ æœªä½¿ç”¨ä»£ç æ£€æŸ¥:" >> backend-build-analysis/quality.log
          npx depcheck 2>&1 >> backend-build-analysis/quality.log || echo "æœªä½¿ç”¨ä»£ç æ£€æŸ¥å®Œæˆ" >> backend-build-analysis/quality.log

          # æ£€æŸ¥ä»£ç å¤æ‚åº¦
          echo "ğŸ“Š ä»£ç å¤æ‚åº¦æ£€æŸ¥:" >> backend-build-analysis/quality.log
          npx complexity-report src/ 2>&1 | head -10 >> backend-build-analysis/quality.log || echo "å¤æ‚åº¦åˆ†æå®Œæˆ" >> backend-build-analysis/quality.log

      - name: Build executable for ${{ matrix.platform }}
        run: |
          echo "ğŸ”¨ å¼€å§‹æ„å»º ${{ matrix.platform }} å¯æ‰§è¡Œæ–‡ä»¶..."

          # åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶è¾“å‡ºç›®å½•
          mkdir -p executables

          # æ ¹æ®å¹³å°è®¾ç½® pkg ç›®æ ‡
          case ${{ matrix.platform }} in
            "windows")
              TARGET="node22-win-x64"
              EXTENSION=".exe"
              ;;
            "linux")
              TARGET="node22-linux-x64"
              EXTENSION=""
              ;;
            "macos")
              TARGET="node22-macos-x64"
              EXTENSION=""
              ;;
            *)
              echo "âŒ æœªçŸ¥å¹³å°: ${{ matrix.platform }}"
              exit 1
              ;;
          esac

          echo "ğŸ¯ ç›®æ ‡å¹³å°: $TARGET" >> backend-build-analysis/build-timeline.log

          # åˆ›å»º pkg é…ç½®æ–‡ä»¶æ¥è§£å†³æ¨¡å—è§£æé—®é¢˜
          cat > pkg-config.json << EOF
          {
            "scripts": ["dist/app.js"],
            "assets": [
              "node_modules/**/*",
              "dist/**/*",
              "package.json"
            ],
            "targets": ["$TARGET"],
            "outputPath": "executables",
            "public": true,
            "compress": "GZip"
          }
          EOF

          # æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆä½¿ç”¨æ›´å…¼å®¹çš„é…ç½®ï¼‰
          pkg dist/app.js \
            --target $TARGET \
            --output executables/happy-tts-${{ matrix.platform }}$EXTENSION \
            --public \
            --compress GZip \
            --config pkg-config.json \
            --no-bytecode \
            --no-native-addons

          # æ£€æŸ¥æ„å»ºç»“æœ
          if [ -f "executables/happy-tts-${{ matrix.platform }}$EXTENSION" ]; then
            echo "âœ… ${{ matrix.platform }} å¯æ‰§è¡Œæ–‡ä»¶æ„å»ºæˆåŠŸ" >> backend-build-analysis/build-timeline.log
            echo "ğŸ“ æ–‡ä»¶å¤§å°: $(du -h executables/happy-tts-${{ matrix.platform }}$EXTENSION | cut -f1)" >> backend-build-analysis/build-timeline.log
          else
            echo "âŒ ${{ matrix.platform }} å¯æ‰§è¡Œæ–‡ä»¶æ„å»ºå¤±è´¥" >> backend-build-analysis/build-timeline.log
            exit 1
          fi
        env:
          NODE_OPTIONS: --max-old-space-size=8192

      - name: Test executable functionality
        run: |
          echo "ğŸ§ª æµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶åŠŸèƒ½..."

          # åˆ›å»ºæµ‹è¯•ç›®å½•
          mkdir -p test-executable
          cd test-executable

          # å¤åˆ¶å¯æ‰§è¡Œæ–‡ä»¶åˆ°æµ‹è¯•ç›®å½•
          cp ../executables/happy-tts-${{ matrix.platform }}$(if [ "${{ matrix.platform }}" = "windows" ]; then echo ".exe"; fi) ./

          # åˆ›å»ºæµ‹è¯•é…ç½®æ–‡ä»¶
          cat > config.json << EOF
          {
            "port": 3000,
            "host": "localhost",
            "environment": "test"
          }
          EOF

          # æµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å¦èƒ½å¯åŠ¨ï¼ˆè¶…æ—¶ 30 ç§’ï¼‰
          echo "ğŸš€ å¯åŠ¨æµ‹è¯•..."
          timeout 30s ./happy-tts-${{ matrix.platform }}$(if [ "${{ matrix.platform }}" = "windows" ]; then echo ".exe"; fi) --help || echo "å¯æ‰§è¡Œæ–‡ä»¶å¯åŠ¨æµ‹è¯•å®Œæˆ"

          echo "âœ… å¯æ‰§è¡Œæ–‡ä»¶åŠŸèƒ½æµ‹è¯•å®Œæˆ" >> ../backend-build-analysis/build-timeline.log
        continue-on-error: true

      - name: Generate Backend Analysis Report
        run: |
          echo "ğŸ“„ ç”Ÿæˆåç«¯åˆ†ææŠ¥å‘Š..."

          # ç”Ÿæˆå®æ—¶åˆ†ææŠ¥å‘Š
          cat > backend-build-analysis/backend-analysis-report.md << EOF
          # ğŸš€ åç«¯æ„å»ºå®æ—¶åˆ†ææŠ¥å‘Š

          **æ„å»ºæ—¶é—´**: $(date)  
          **Node.js ç‰ˆæœ¬**: $(node --version)  
          **NPM ç‰ˆæœ¬**: $(npm --version)  
          **ç›®æ ‡å¹³å°**: ${{ matrix.platform }}
          **pkg ç‰ˆæœ¬**: $(pkg --version)

          ---

          ## â° æ„å»ºæ—¶é—´çº¿

          \`\`\`bash
          $(cat backend-build-analysis/build-timeline.log 2>/dev/null || echo "æ„å»ºæ—¶é—´çº¿æ—¥å¿—ä¸å¯ç”¨")
          \`\`\`

          ---

          ## ğŸ“Š æ„å»ºäº§ç‰©åˆ†æ

          ### ç›®å½•ç»“æ„
          \`\`\`bash
          $(cat backend-build-analysis/bundle-structure.log 2>/dev/null || echo "ç›®å½•ç»“æ„åˆ†æä¸å¯ç”¨")
          \`\`\`

          ### JavaScript æ–‡ä»¶åˆ†æ
          \`\`\`bash
          $(cat backend-build-analysis/js-analysis.log 2>/dev/null || echo "JavaScript åˆ†æä¸å¯ç”¨")
          \`\`\`

          ### ä¾èµ–å…³ç³»åˆ†æ
          \`\`\`bash
          $(cat backend-build-analysis/dependency-analysis.log 2>/dev/null || echo "ä¾èµ–å…³ç³»åˆ†æä¸å¯ç”¨")
          \`\`\`

          ---

          ## âš¡ æ€§èƒ½åˆ†æ

          ### å‹ç¼©æ•ˆæœ
          \`\`\`bash
          $(cat backend-build-analysis/performance.log 2>/dev/null || echo "æ€§èƒ½åˆ†æä¸å¯ç”¨")
          \`\`\`

          ---

          ## ğŸ”’ å®‰å…¨åˆ†æ

          \`\`\`bash
          $(cat backend-build-analysis/security.log 2>/dev/null || echo "å®‰å…¨åˆ†æä¸å¯ç”¨")
          \`\`\`

          ---

          ## ğŸ“‹ è´¨é‡åˆ†æ

          \`\`\`bash
          $(cat backend-build-analysis/quality.log 2>/dev/null || echo "è´¨é‡åˆ†æä¸å¯ç”¨")
          \`\`\`

          ---

          ## ğŸ¯ æ„å»ºçŠ¶æ€

          - âœ… åç«¯æ„å»ºå®Œæˆ
          - âœ… TypeScript ç¼–è¯‘å®Œæˆ
          - âœ… å¯æ‰§è¡Œæ–‡ä»¶ç”Ÿæˆå®Œæˆ
          - âœ… å®æ—¶åˆ†æå®Œæˆ
          - âœ… æ€§èƒ½åˆ†æå®Œæˆ
          - âœ… å®‰å…¨åˆ†æå®Œæˆ
          - âœ… è´¨é‡åˆ†æå®Œæˆ

          ---

          *æŠ¥å‘Šç”Ÿæˆæ—¶é—´: $(date)*
          EOF

          # è¾“å‡ºåˆ° GitHub Actions æ‘˜è¦
          cat >> $GITHUB_STEP_SUMMARY << EOF

          ## ğŸš€ åç«¯æ„å»ºå®æ—¶åˆ†æ - ${{ matrix.platform }}

          ### ğŸ“Š æ„å»ºç»Ÿè®¡
          - **æ„å»ºæ—¶é—´**: $(date)
          - **ç›®æ ‡å¹³å°**: ${{ matrix.platform }}
          - **æ€»æ–‡ä»¶æ•°**: $(find dist/ -type f 2>/dev/null | wc -l)
          - **æ€»å¤§å°**: $(du -sh dist/ 2>/dev/null | cut -f1 || echo "æœªçŸ¥")

          ### âš¡ æ€§èƒ½æŒ‡æ ‡
          - **JavaScript æ–‡ä»¶**: $(find dist/ -name "*.js" 2>/dev/null | wc -l)
          - **å¯æ‰§è¡Œæ–‡ä»¶å¤§å°**: $(du -h executables/happy-tts-${{ matrix.platform }}$(if [ "${{ matrix.platform }}" = "windows" ]; then echo ".exe"; fi) 2>/dev/null | cut -f1 || echo "æœªçŸ¥")

          ### ğŸ”’ å®‰å…¨æ£€æŸ¥
          - **æ•æ„Ÿä¿¡æ¯**: $(grep -r -i "password\|secret\|key\|token" dist/ 2>/dev/null | wc -l) ä¸ª
          - **ç¡¬ç¼–ç  URL**: $(grep -r "http://\|https://" dist/ 2>/dev/null | grep -v "localhost" | wc -l) ä¸ª

          ### ğŸ“‹ è´¨é‡æ£€æŸ¥
          - **TypeScript é”™è¯¯**: $(grep -c "error" backend-build-analysis/quality.log 2>/dev/null || echo "0")
          - **æœªä½¿ç”¨ä¾èµ–**: $(grep -c "unused" backend-build-analysis/quality.log 2>/dev/null || echo "0")

          [ğŸ“„ è¯¦ç»†æŠ¥å‘Š](backend-build-analysis/backend-analysis-report.md)
          EOF

          echo "ğŸ“„ åç«¯åˆ†ææŠ¥å‘Šå·²ç”Ÿæˆ"

      - name: Upload backend artifacts
        uses: actions/upload-artifact@main
        with:
          name: backend-executables-${{ matrix.platform }}
          path: |
            executables/
            dist/
            dist-obfuscated/
            backend-build-analysis/
          retention-days: 30

  build-all-platforms:
    needs: build-backend
    runs-on: ubuntu-latest
    if: github.event.inputs.platform == 'all' || github.event_name != 'workflow_dispatch'

    steps:
      - name: Download all platform artifacts
        uses: actions/download-artifact@main
        with:
          pattern: backend-executables-*
          merge-multiple: true
          path: all-executables

      - name: Create release package
        run: |
          echo "ğŸ“¦ åˆ›å»ºå‘å¸ƒåŒ…..."

          # åˆ›å»ºå‘å¸ƒç›®å½•
          mkdir -p release

          # å¤åˆ¶æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶
          cp -r all-executables/executables/* release/

          # åˆ›å»ºç‰ˆæœ¬ä¿¡æ¯æ–‡ä»¶
          cat > release/version.txt << EOF
          Happy TTS Backend Executables
          Version: $(date +%Y.%m.%d)
          Build Date: $(date)
          Node.js Version: $(node --version)
          Platform: All (Windows, Linux, macOS)

          Files:
          $(ls -la release/)
          EOF

          # åˆ›å»ºä½¿ç”¨è¯´æ˜
          cat > release/README.md << EOF
          # Happy TTS Backend Executables

          ## å¹³å°æ”¯æŒ
          - **Windows**: happy-tts-windows.exe
          - **Linux**: happy-tts-linux
          - **macOS**: happy-tts-macos

          ## ä½¿ç”¨æ–¹æ³•
          1. ä¸‹è½½å¯¹åº”å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶
          2. ç¡®ä¿æœ‰æ‰§è¡Œæƒé™ï¼ˆLinux/macOSï¼‰
          3. è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶

          ## é…ç½®
          åˆ›å»º config.json æ–‡ä»¶è¿›è¡Œé…ç½®ï¼š
          \`\`\`json
          {
            "port": 3000,
            "host": "localhost",
            "environment": "production"
          }
          \`\`\`

          ## æ³¨æ„äº‹é¡¹
          - ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
          - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
          - ç¡®ä¿ç«¯å£æœªè¢«å ç”¨
          EOF

      - name: Upload release package
        uses: actions/upload-artifact@main
        with:
          name: happy-tts-backend-release
          path: |
            release/
          retention-days: 30

      - name: Generate final report
        run: |
          echo "ğŸ“‹ ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š..."

          cat >> $GITHUB_STEP_SUMMARY << EOF

          # ğŸ‰ åç«¯æ„å»ºå®Œæˆ

          ## ğŸ“¦ æ„å»ºäº§ç‰©
          - âœ… Windows å¯æ‰§è¡Œæ–‡ä»¶ (happy-tts-windows.exe)
          - âœ… Linux å¯æ‰§è¡Œæ–‡ä»¶ (happy-tts-linux)
          - âœ… macOS å¯æ‰§è¡Œæ–‡ä»¶ (happy-tts-macos)

          ## ğŸ“Š æ„å»ºç»Ÿè®¡
          - **æ„å»ºæ—¶é—´**: $(date)
          - **æ€»æ–‡ä»¶æ•°**: $(find release/ -type f 2>/dev/null | wc -l)
          - **æ€»å¤§å°**: $(du -sh release/ 2>/dev/null | cut -f1 || echo "æœªçŸ¥")

          ## ğŸš€ ä¸‹ä¸€æ­¥
          1. ä¸‹è½½å¯¹åº”å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶
          2. é…ç½®è¿è¡Œç¯å¢ƒ
          3. å¯åŠ¨æœåŠ¡

          [ğŸ“¦ ä¸‹è½½å‘å¸ƒåŒ…](release/)
          EOF
